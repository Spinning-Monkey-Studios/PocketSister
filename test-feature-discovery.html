<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feature Discovery System Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .button:hover {
            background: #0056b3;
        }
        
        .button.primary {
            background: #28a745;
        }
        
        .button.secondary {
            background: #6c757d;
        }
        
        .result {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        
        .success {
            color: #155724;
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        .info {
            color: #0c5460;
            background: #d1ecf1;
            border-color: #bee5eb;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .feature-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 16px;
            margin: 10px 0;
        }

        .feature-title {
            font-weight: bold;
            color: #343a40;
            margin-bottom: 8px;
        }

        .feature-description {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .feature-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-free {
            background: #d4edda;
            color: #155724;
        }

        .badge-premium {
            background: #fff3cd;
            color: #856404;
        }

        .badge-family {
            background: #cce7ff;
            color: #0066cc;
        }

        .chat-demo {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .message {
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 12px;
            max-width: 80%;
        }

        .user-message {
            background: #007bff;
            color: white;
            margin-left: auto;
        }

        .ai-message {
            background: #e9ecef;
            color: #343a40;
        }
    </style>
</head>
<body>
    <h1>ü§ñ AI Feature Discovery System Test</h1>
    
    <div class="test-section">
        <h2>üìñ System Overview</h2>
        <p>This system enables Stella (the AI) to intelligently respond to user questions about app features, capabilities, and upgrades. The AI can now provide contextual help and guide users to the right features or subscription plans.</p>
        <div class="info result">
Intelligent Feature Discovery:
‚úì AI understands all app features and capabilities
‚úì Provides contextual help based on user queries  
‚úì Generates personalized upgrade recommendations
‚úì Explains subscription plans and benefits
‚úì Guides users to relevant features they might not know about
        </div>
    </div>

    <div class="grid">
        <div class="test-section">
            <h2>üéØ Feature Information Testing</h2>
            <button class="button" onclick="testFeatureInfo('ai_chat')">Test AI Chat Info</button>
            <button class="button" onclick="testFeatureInfo('voice_synthesis')">Test Voice Features</button>
            <button class="button" onclick="testFeatureInfo('mood_tracking')">Test Mood Tracking</button>
            <button class="button" onclick="testFeatureInfo('invalid_feature')">Test Invalid Feature</button>
            <div id="featureResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üìä Plan Comparison Testing</h2>
            <button class="button primary" onclick="testPlanComparison()">Get All Plans</button>
            <button class="button" onclick="testFeaturesByPlan('free')">Free Plan Features</button>
            <button class="button" onclick="testFeaturesByPlan('premium')">Premium Plan Features</button>
            <div id="planResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üé™ Contextual Help Testing</h2>
            <button class="button" onclick="testContextualHelp('How can I talk to Stella with my voice?')">Voice Questions</button>
            <button class="button" onclick="testContextualHelp('What features do I get if I upgrade?')">Upgrade Questions</button>
            <button class="button" onclick="testContextualHelp('Can you track my mood?')">Mood Questions</button>
            <button class="button" onclick="testContextualHelp('What can this app do?')">General Questions</button>
            <div id="helpResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>‚¨ÜÔ∏è Upgrade Recommendations</h2>
            <button class="button primary" onclick="testUpgradeRecommendations('demo-user')">Get Recommendations</button>
            <div id="upgradeResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>üí¨ AI Chat Simulation</h2>
        <p>Test how Stella responds to feature-related questions using the new discovery system:</p>
        <div class="grid">
            <div>
                <button class="button primary" onclick="simulateChat('What features do you have?')">Ask About Features</button>
                <button class="button" onclick="simulateChat('How can I hear your voice?')">Ask About Voice</button>
                <button class="button" onclick="simulateChat('Can you help me track my emotions?')">Ask About Mood Tracking</button>
                <button class="button" onclick="simulateChat('What if I upgrade to premium?')">Ask About Upgrades</button>
            </div>
            <div class="chat-demo" id="chatDemo">
                <div class="message ai-message">Hi! I'm Stella, your AI companion. Ask me anything about what I can do! ‚ú®</div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìö Feature Catalog</h2>
        <button class="button" onclick="displayFeatureCatalog()">Load Feature Catalog</button>
        <div id="catalogResult" style="display: none;"></div>
    </div>

    <script>
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = content;
            element.style.display = 'block';
        }

        function formatJsonResult(elementId, data, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `result ${type}`;
            element.textContent = JSON.stringify(data, null, 2);
            element.style.display = 'block';
        }

        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method,
                    headers: { 'Content-Type': 'application/json' }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(endpoint, options);
                const result = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: result
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        // Feature Information Testing
        async function testFeatureInfo(featureName) {
            showResult('featureResult', `Getting information about ${featureName}...`, 'info');
            const result = await apiCall(`/api/features/${featureName}`);
            
            if (result.success) {
                formatJsonResult('featureResult', result.data, 'success');
            } else {
                showResult('featureResult', `Error: ${result.error || result.data?.message}`, 'error');
            }
        }

        async function testFeaturesByPlan(planId) {
            showResult('planResult', `Getting features for ${planId} plan...`, 'info');
            const result = await apiCall(`/api/features?plan=${planId}`);
            
            if (result.success) {
                formatJsonResult('planResult', result.data, 'success');
            } else {
                showResult('planResult', `Error: ${result.error || result.data?.message}`, 'error');
            }
        }

        // Plan Comparison Testing
        async function testPlanComparison() {
            showResult('planResult', 'Getting plan comparison...', 'info');
            const result = await apiCall('/api/plans');
            
            if (result.success) {
                formatJsonResult('planResult', result.data, 'success');
            } else {
                showResult('planResult', `Error: ${result.error || result.data?.message}`, 'error');
            }
        }

        // Contextual Help Testing
        async function testContextualHelp(query) {
            showResult('helpResult', `Getting contextual help for: "${query}"...`, 'info');
            const result = await apiCall('/api/contextual-help', 'POST', { query });
            
            if (result.success) {
                formatJsonResult('helpResult', result.data, 'success');
            } else {
                showResult('helpResult', `Error: ${result.error || result.data?.message}`, 'error');
            }
        }

        // Upgrade Recommendations Testing
        async function testUpgradeRecommendations(userId) {
            showResult('upgradeResult', 'Getting upgrade recommendations...', 'info');
            const result = await apiCall(`/api/upgrade-recommendations/${userId}`);
            
            if (result.success) {
                formatJsonResult('upgradeResult', result.data, 'success');
            } else {
                showResult('upgradeResult', `Error: ${result.error || result.data?.message}`, 'error');
            }
        }

        // Chat Simulation
        async function simulateChat(userMessage) {
            const chatDemo = document.getElementById('chatDemo');
            
            // Add user message
            const userDiv = document.createElement('div');
            userDiv.className = 'message user-message';
            userDiv.textContent = userMessage;
            chatDemo.appendChild(userDiv);

            // Add thinking indicator
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'message ai-message';
            thinkingDiv.textContent = 'Stella is thinking...';
            chatDemo.appendChild(thinkingDiv);
            chatDemo.scrollTop = chatDemo.scrollHeight;

            // Simulate AI response using contextual help
            const result = await apiCall('/api/contextual-help', 'POST', { query: userMessage });
            
            // Remove thinking indicator
            chatDemo.removeChild(thinkingDiv);
            
            // Add AI response
            const aiDiv = document.createElement('div');
            aiDiv.className = 'message ai-message';
            
            if (result.success) {
                const helpInfo = result.data;
                let response = helpInfo.helpText + '\n\n';
                
                if (helpInfo.features && helpInfo.features.length > 0) {
                    response += 'Here are the relevant features:\n';
                    helpInfo.features.forEach(feature => {
                        response += `‚Ä¢ ${feature.name}: ${feature.description}\n`;
                    });
                }
                
                if (helpInfo.upgradeOptions && helpInfo.upgradeOptions.length > 0) {
                    response += '\nYou might be interested in upgrading to:\n';
                    helpInfo.upgradeOptions.forEach(plan => {
                        response += `‚Ä¢ ${plan.name} (${plan.price}): ${plan.description}\n`;
                    });
                }
                
                aiDiv.textContent = response || 'I can help you with that! Let me know what specific features you\'re curious about.';
            } else {
                aiDiv.textContent = 'Sorry, I had trouble understanding that question. Can you ask me about specific features like voice responses, mood tracking, or our subscription plans?';
            }
            
            chatDemo.appendChild(aiDiv);
            chatDemo.scrollTop = chatDemo.scrollHeight;
        }

        // Feature Catalog Display
        async function displayFeatureCatalog() {
            const catalogDiv = document.getElementById('catalogResult');
            catalogDiv.innerHTML = '<p>Loading feature catalog...</p>';
            catalogDiv.style.display = 'block';
            
            const result = await apiCall('/api/features');
            
            if (result.success) {
                const features = result.data;
                let html = '<h3>Complete Feature Catalog</h3>';
                
                // Display by category
                Object.entries(features).forEach(([category, categoryFeatures]) => {
                    html += `<h4>${category.charAt(0).toUpperCase() + category.slice(1)} Features</h4>`;
                    
                    categoryFeatures.forEach(feature => {
                        html += `
                            <div class="feature-card">
                                <div class="feature-title">${feature.name}</div>
                                <div class="feature-description">${feature.description}</div>
                                <div class="feature-meta">
                                    <span class="badge badge-${feature.availability}">${feature.availability}</span>
                                    ${feature.tokenCost ? `<span class="badge">ü™ô ${feature.tokenCost} tokens</span>` : ''}
                                </div>
                                ${feature.benefits ? `<ul>${feature.benefits.map(b => `<li>${b}</li>`).join('')}</ul>` : ''}
                                ${feature.upgradePrompt ? `<p><strong>Upgrade:</strong> ${feature.upgradePrompt}</p>` : ''}
                            </div>
                        `;
                    });
                });
                
                catalogDiv.innerHTML = html;
            } else {
                catalogDiv.innerHTML = `<p class="error">Error loading catalog: ${result.error || result.data?.message}</p>`;
            }
        }

        // Auto-load plan comparison on page load
        window.addEventListener('load', () => {
            testPlanComparison();
        });
    </script>
</body>
</html>